<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ü5-2</title>
</head>
<body>
    <h1>Rednerliste</h1>
    <label for="name">Neuer Redner:</label>
    <input id="name" type="text">
    <button id="buttonadd">Hinzufügen</button>
    <ul></ul>
    <script>
        let inputfield = document.getElementById("name");
        let list = document.querySelector("ul")

        let rednernamen = []
        let redezeiten = []
        let aktiverRedner = null;
        let aktiverRednerStartzeit = null;

        function numToHuman(num) {
            return Math.floor(num).toString().padStart(2, "0")
        }

        function erzeugeTimeString() {
            let ms = redezeiten[aktiverRedner] + Date.now() - aktiverRednerStartzeit
            let s = numToHuman((ms / 1000) % 60);
            let min = numToHuman((ms / (60 * 1000)) % 60);
            let h = numToHuman(ms / (60 * 60 * 1000))
            return ` ${h}:${min}:${s} `
        }

        function rednerStoppen() {
            if (aktiverRedner != null) {
                redezeiten[aktiverRedner] += Date.now() - aktiverRednerStartzeit;
                list.children[aktiverRedner].querySelector("button").textContent = "Start!"
                list.children[aktiverRedner].textContent
                aktiverRedner = null;
                aktiverRednerStartzeit = null;
            }
        }

        document.getElementById("buttonadd").addEventListener("click", (evt) => {
            // Vorherigen Redner Stoppen
            rednerStoppen();
        
            let aktuellerRednerIndex = rednernamen.length;
            // Neuen Redner Erzeugen
            rednernamen.push(inputfield.value);
            redezeiten.push(0)
            aktiverRedner = aktuellerRednerIndex;
            aktiverRednerStartzeit = Date.now()

            // Elemente für neuen Redner erzeugen
            let listelem = document.createElement("li");
            listelem.textContent = inputfield.value;
            let timetext = document.createElement("span");
            timetext.innerText = " 00:00:00 "
            listelem.appendChild(timetext)
            let listbutton = document.createElement("button")
            listbutton.textContent = "Stopp!"
            listbutton.addEventListener("click", (event) => {
                let starten = aktiverRedner != aktuellerRednerIndex;
                rednerStoppen()
                if (starten) {
                    listbutton.innerText = "Stopp!"
                    aktiverRedner = aktuellerRednerIndex;
                    aktiverRednerStartzeit = Date.now();
                }
            });
            listelem.appendChild(listbutton);
            // DOM Update
            list.appendChild(listelem);
            inputfield.value = "";
        })

        setInterval(()=>{
            if (aktiverRedner == null) return;
            list.children[aktiverRedner].querySelector("span").innerText = erzeugeTimeString();
        }, 100);
    </script>
</body>
</html>